javascript:(function(){if(document.getElementById('msg-scraper-panel'))return;let messageHistory=[];let globalSeenHashes=new Set();let isRecording=false;let scraperInterval=null;let isScrolling=false;let scrollSpeed=2;let scrollDir=-1;let scrollFrameId=null;let scrollTargetElement=null;function getHash(type,text){const clean=text.toLowerCase().replace(/(today at|yesterday at|at|[^a-z0-9])/g,"");return`${type}_${clean}`;}function isDateText(rawText){if(!rawText||rawText.length>50)return false;const text=rawText.replace(/[\u202F\u00A0]/g,' ').trim();const wordPatterns=/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec|Mon|Tue|Wed|Thu|Fri|Sat|Sun|Yesterday|Today|Tomorrow)/i;const datePattern=/\d{1,2}[\/\-\.]\d{1,2}[\/\-\.]\d{2,4}/;const timePattern=/\d{1,2}:\d{2}/;return wordPatterns.test(text)||datePattern.test(text)||timePattern.test(text);}function findScrollableTarget(){const candidates=document.querySelectorAll('div');let largest=null;let maxArea=0;candidates.forEach(el=>{if(el.scrollHeight>el.clientHeight){const style=window.getComputedStyle(el);if(style.overflowY==='auto'||style.overflowY==='scroll'){const area=el.clientWidth*el.clientHeight;if(area>maxArea){maxArea=area;largest=el;}}}});return largest||window;}const panel=document.createElement('div');panel.id='msg-scraper-panel';panel.style.cssText='position:fixed; top:80px; right:20px; width:260px; background:#0e0e0e; color:white; padding:15px; border-radius:12px; z-index:9999; font-family:sans-serif; box-shadow: 0 8px 32px rgba(0,0,0,0.8); border: 1px solid #333;';const title=document.createElement('h3');title.innerText="6-Month Session Scraper";title.style.cssText='margin:0 0 5px 0; font-size:14px; text-align:center; color:#ff00ea; font-weight:900;';const counter=document.createElement('div');counter.innerText="0 Items Captured";counter.style.cssText='font-size:18px; text-align:center; margin-bottom:15px; font-weight:bold; color:#00ff88;';const btnRecord=document.createElement('button');btnRecord.innerText="â–¶ START RECORDING";btnRecord.style.cssText='width:100%; padding:10px; margin-bottom:15px; background:#28a745; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;';const scrollBtnContainer=document.createElement('div');scrollBtnContainer.style.cssText='display:flex; gap:5px; margin-bottom:10px;';const btnScrollUp=document.createElement('button');btnScrollUp.innerText="â¬† UP";btnScrollUp.style.cssText='flex:1; padding:8px; background:#333; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;';const btnScrollStop=document.createElement('button');btnScrollStop.innerText="â¹";btnScrollStop.style.cssText='width:40px; padding:8px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;';const btnScrollDown=document.createElement('button');btnScrollDown.innerText="â¬‡ DOWN";btnScrollDown.style.cssText='flex:1; padding:8px; background:#333; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;';scrollBtnContainer.appendChild(btnScrollUp);scrollBtnContainer.appendChild(btnScrollStop);scrollBtnContainer.appendChild(btnScrollDown);const speedContainer=document.createElement('div');speedContainer.style.cssText='display:flex; align-items:center; gap:10px; margin-bottom:15px;';const speedInput=document.createElement('input');speedInput.type="range";speedInput.min="1";speedInput.max="40";speedInput.value="2";speedInput.style.cssText='flex:1; cursor:pointer;';const speedVal=document.createElement('span');speedVal.innerText="Speed: 2";speedVal.style.cssText='font-size:11px; color:#888; width:50px; text-align:right;';speedContainer.appendChild(speedInput);speedContainer.appendChild(speedVal);const btnSave=document.createElement('button');btnSave.innerText="ðŸ’¾ DOWNLOAD JSON";btnSave.style.cssText='width:100%; padding:10px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; display:none;';const btnClose=document.createElement('button');btnClose.innerText="âŒ Close";btnClose.style.cssText='margin-top:10px; background:none; border:none; color:#555; width:100%; cursor:pointer; font-size:11px;';panel.appendChild(title);panel.appendChild(counter);panel.appendChild(btnRecord);panel.appendChild(scrollBtnContainer);panel.appendChild(speedContainer);panel.appendChild(btnSave);panel.appendChild(btnClose);document.body.appendChild(panel);function scrollTick(){if(!isScrolling||!scrollTargetElement)return;scrollTargetElement.scrollBy(0,scrollDir*scrollSpeed);scrollFrameId=requestAnimationFrame(scrollTick);}function setScroll(state,dir){isScrolling=state;if(dir)scrollDir=dir;if(state){scrollTargetElement=findScrollableTarget();if(scrollTargetElement!==window)scrollTargetElement.style.boxShadow="inset 0 0 30px rgba(255,0,234,0.2)";cancelAnimationFrame(scrollFrameId);scrollTick();}else{cancelAnimationFrame(scrollFrameId);if(scrollTargetElement)scrollTargetElement.style.boxShadow="none";}}function scanMessages(){const mainChat=document.querySelector('[role="main"]');if(!mainChat)return;const elements=mainChat.querySelectorAll('div[role="row"], span');const screenMiddle=window.innerWidth/2;let batch=[];elements.forEach(el=>{const rect=el.getBoundingClientRect();if(rect.bottom<0||rect.top>window.innerHeight)return;if(el.getAttribute('data-scraped-v4')==='true')return;if(el.getAttribute('role')==='row'){let rowParts=[];let rowType="";const bubbles=el.querySelectorAll('div[dir="auto"], img, video');bubbles.forEach(bubble=>{if(bubble.tagName==='IMG'&&bubble.getBoundingClientRect().width<40&&!(bubble.src||"").includes('emoji'))return;const bRect=bubble.getBoundingClientRect();const type=bRect.left>screenMiddle?"Sent":"Received";if(!rowType)rowType=type;let txt=(bubble.tagName==='DIV')?bubble.innerText.trim():(bubble.getAttribute('alt')||(bubble.tagName==='VIDEO'?"[Video]":"[Image]"));if(txt){bubble.style.border=type==="Sent"?"3px solid #00ff00":"3px solid #0000ff";rowParts.push(txt);}});if(rowParts.length>0)batch.push({el:el,top:rect.top,data:{type:rowType,text:rowParts.join(" ")}});}else{const rawText=el.innerText.trim().split('\n')[0];if(isDateText(rawText)&&!el.querySelector('span')){el.style.border="2px dashed #ff00ea";batch.push({el:el,top:rect.top,data:{type:"Timestamp",text:rawText}});}}});batch.sort((a,b)=>a.top-b.top);let uniqueBatchToAdd=[];batch.forEach(item=>{const h=getHash(item.data.type,item.data.text);if(!globalSeenHashes.has(h)){globalSeenHashes.add(h);item.el.setAttribute('data-scraped-v4','true');uniqueBatchToAdd.push(item.data);}else{item.el.setAttribute('data-scraped-v4','true');}});if(uniqueBatchToAdd.length>0){if(scrollDir===-1)messageHistory=[...uniqueBatchToAdd,...messageHistory];else messageHistory=[...messageHistory,...uniqueBatchToAdd];}counter.innerText=%60${messageHistory.length} Items Captured%60;}btnRecord.onclick=function(){if(!isRecording){isRecording=true;btnRecord.innerText="â¸ PAUSE";btnRecord.style.backgroundColor="#ffc107";btnSave.style.display="block";scraperInterval=setInterval(scanMessages,800);}else{isRecording=false;clearInterval(scraperInterval);btnRecord.innerText="â–¶ RESUME";btnRecord.style.backgroundColor="#28a745";}};btnScrollUp.onclick=()=>setScroll(true,-1);btnScrollDown.onclick=()=>setScroll(true,1);btnScrollStop.onclick=()=>setScroll(false,null);speedInput.oninput=function(){scrollSpeed=parseInt(this.value);speedVal.innerText=%60Speed: ${this.value}%60;};btnSave.onclick=function(){setScroll(false);isRecording=false;clearInterval(scraperInterval);const blob=new Blob([JSON.stringify(messageHistory,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="messenger_6month_archive.json";document.body.appendChild(a);a.click();counter.innerText=%60Final: ${messageHistory.length} items!%60;};btnClose.onclick=function(){setScroll(false);clearInterval(scraperInterval);panel.remove();};})();
